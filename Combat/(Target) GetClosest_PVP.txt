/////////////////////////////////////////////
// UO Steam Get Closest Enemy Macro (for PVP)
// for Outlands
//
// Greetings and thank you for your interest in this script!
// This macro is *primarily* for PVP, and is a "general purpose"
// script for most players on the shard doing PVP. Its primary
// purpose is to scan around you for the closest target, and set
// that target to 'last'. Please note - it will NOT attack your 
// target. 
//
// What makes it PVP?
// 
//    If you look at the filter below, it does not have a "humanoid"
//    entry. Thus you will pick up any type of mob/player closest to you,
//    matching the existing filter.
//
//    You can still use it for PVP, but it will pick up red pets for example,
//    and not prioritize the red player. 
//
// Friends List
// 
//    Add anything you do not want to target to your friends list. This includes
//    guild PKs, their pets, guildies who flag grey, etc. Once on that list,
//    the macro will no longer pick them up.
//
// How do I attack?
// 
//    This script works by setting your 'last' alias. You can bind 'Attack Last'
//    to a hotkey if you want or use the script named 'AttackLast.txt' 
//
// Why 'last' and not 'enemy'?
//
//    'last' and 'enemy' are UOSteam _system_ aliases which are maintained by 
//    UOSteam on your behalf. You can set the 'enemy' alias if you want, but
//    it maybe be overriden by the next thing that attacks you. This is why
//    I prefer 'last'.
//
// Why not 'transformation'?
//
//    A lot of people confuse the 'transformation' filter with Polymorph. Its
//    100% different. Transformation is for gargoyle, elf, vampire body types.
//    This shard does not use those.
//
// Questions?
//
//    If you have questions on why its written this way, or what I am doing,
//    just PM me in discord. I could write articles on the UO targetting system,
//    but I won't do that here.
//
// How to use:
// ===========
// 1) Make sure you have '[X] Highlight Current Target' enabled in UOSteam
// 2) Run script any time to get an enemy.
//
// Version History:
// ----------------
// * 1.0 complete rewrite
//
// >> COPY BELOW >> 
/////////////////////////////////////////////

//
// Create temporary list
// 
@removelist 'found'
@createlist 'found'

//
// Scan for targets
//
for 0 to 20
    @unsetalias 'enemy'
    @getenemy 'murderer' 'enemy' 'criminal' 'gray' 'next'
    @pushlist! 'found' 'enemy'
endfor

//
// Create a distances list, seeding from 1
// 
@removelist 'distances'
@createlist 'distances'
pushlist 'distances' 1
pushlist 'distances' 2
pushlist 'distances' 3
pushlist 'distances' 4
pushlist 'distances' 5
pushlist 'distances' 6
pushlist 'distances' 7
pushlist 'distances' 8
pushlist 'distances' 9
pushlist 'distances' 10
pushlist 'distances' 11
pushlist 'distances' 12
pushlist 'distances' 13
pushlist 'distances' 14
pushlist 'distances' 15
pushlist 'distances' 16
pushlist 'distances' 17
pushlist 'distances' 18
pushlist 'distances' 19
pushlist 'distances' 20

//
// Sort by distance
//  
@unsetalias 'enemy'
@removelist 'targets'
@createlist 'targets'
for 0 to 'distances'
    sysmsg 'distances[]'
    for 0 to 'found'
        if @findobject found[] 0 0 0 distances[] and not @findobject 'last'
            @setalias 'last' found[0]
            break
        endif
    endfor
endfor

//
// Player feedback
//
if @findobject 'last'
    headmsg "*Target Set*" 22
    getenemy 'last'
else
    headmsg "No targets" 44
endif